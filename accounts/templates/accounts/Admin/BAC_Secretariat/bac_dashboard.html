{% extends "accounts/Admin/BAC_Secretariat/bac.html" %}

{% load static %}

{% block bac_dashboard %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dynamic Display</title>
  <style>
    .container-fluid {
      height: 68vh;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .container {
      text-align: center;
    }

    input,
    select {
      margin-bottom: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th,
    td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
    }

    .update-btn,
    .delete-btn {
      cursor: pointer;
      color: blue;
    }

    .h4 {
      text-align: left;
    }

    .dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-arrow {
      position: absolute;
      top: 50%;
      right: 10px;
      /* Adjust the right distance as needed */
      transform: translateY(-50%);
    }
    .container {
      border: 1px solid #ddd;
      padding: 10px;
      width: 200px;
      cursor: pointer;
    }
    .option:hover {
      background-color: #e0e0e0; /* Change the background color on hover */
      cursor: pointer;
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>

  <div class="container-fluid">
    
      <h1 class="pr text-center pt-4">Available Items</h1>



      <form action="{% url 'upload_file' %}" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <label for="file">Choose CSV file:</label>
        <input type="file" name="file" accept=".csv" required>
        <br>
        <button class="btn btn-success" type="submit">
          <i class="fas fa-file-upload"></i> Upload
        </button>
        
        
      </form>
      <br>

      <div class="dropdown" style="width: 45%;">
        <div>
          <div class="container" onclick="showOptions()" style="user-select: none;">Select Category</div>
        </div>
        
        <div id="options" class="d-none position-absolute z-1 bg-white " style="user-select: none; width: 100%; max-height: 200px; overflow-y: auto; text-align: center;">
          <div class="option" onclick="selectCategory('all')">All Categories</div>
          {% for category, items in grouped_data.items %}
            <div class="option" onclick="selectCategory('{{ category }}')">{{ category }}</div>
          {% endfor %}

          <div>
            <div id="newInputField" class="option hidden">
              <form method="post" action="{% url 'bac_dashboard' %}">
                {% csrf_token %}
              <input type="text" id="custom-category" name="custom-category" placeholder="Make New Category">
              </form>
            </div>
            <div class="option" onclick="showInputField()">Add Category</div>
          </div>
        </div>
          
          <script>
            function showInputField() {
              var newInputField = document.getElementById("newInputField");
              newInputField.classList.toggle("hidden");
            }
          
          
           
        
          function showOptions() {
            var options = document.getElementById("options");
            if (options.classList.contains("d-none")) {
              options.classList.remove("d-none");
            } else {
              options.classList.add("d-none");
            }
          }

        
          function selectCategory(category) {
            // Hide all tables and "Add" buttons
            var tables = document.querySelectorAll('.category-table');
            var addButtons = document.querySelectorAll('.add-btn');
        
            tables.forEach(function (table) {
              table.style.display = 'none';
            });
        
            addButtons.forEach(function (button) {
              button.style.display = 'none';
            });
        
            // Show the selected table and its "Add" button
            if (category === 'all') {
              // Show all tables and "Add" buttons if "All Categories" is selected
              tables.forEach(function (table) {
                table.style.display = '';
              });
        
              addButtons.forEach(function (button) {
                button.style.display = '';
              });
            } else {
              // Show the table and "Add" button corresponding to the selected category
              var selectedTable = document.getElementById('table-' + category);
              var addButton = document.getElementById('add-btn-' + category);
        
              if (selectedTable && addButton) {
                selectedTable.style.display = '';
                addButton.style.display = '';
              }
            }
        
            // Hide the options after selecting a category
            var options = document.getElementById("options");
            options.classList.add("d-none");
          }
        
          
        </script>
        

      </div>

      {% for category, items in grouped_data.items %}
      <table class="category-table" id="table-{{ category }}">
        <thead>
          <tr>
            <th colspan="6" class="text-center">
              {{ category }}
              <a href="{% url 'delete_category' Category=category %}">
                <i class="fas fa-trash-alt text-danger"></i> <!-- Replace 'fa-trash-alt' with the actual trash icon class -->
              </a>
            </th>


          </tr>
          <tr>
            <th></th>
            <th>Item Name</th>
            <th>Item Brand/Description</th>
            <th>Unit</th>
            <th>Price</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for item in items %}
          <tr>
            <td class="text-center">{{ forloop.counter }}</td>
            <td>{{ item.Item_name }}</td>
            <td>{{ item.Item_Brand }}</td>
            <td>{{ item.Unit }}</td>
            <td>{{ item.Price }}</td>
           
          
            <td>
              <div style="display: flex; justify-content: center; gap: 20px;">
                <a href="#" style="text-align: center;">
                  <i class="fas fa-edit text-primary"></i>
                </a>
                
                {% if item.id %}
                  <a href="{% url 'delete_item' item.id %}" style="text-align: center;">
                    <i class="fas fa-trash-alt text-danger"></i>
                  </a>
                {% endif %} 
            </div>
          </td>
        </tr>
      {% endfor %}
    </tbody>
</table>

      <button class="add-btn btn-primary float-left mt-2 mb-2" id="add-btn-{{ category }}"
        onclick="toggleNewItemRow('{{ category }}')">+</button>

      {% endfor %}


  
  </div>


  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">


</body>

</html>

{% endblock %}