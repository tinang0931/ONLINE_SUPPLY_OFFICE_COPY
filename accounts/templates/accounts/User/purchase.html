{% extends "accounts/User/main.html" %}


{% load static %}


{% block purchase %}

<style>
    .table-bordered th {
        background-color: #1c96c5;
    }

    .item-actions {
        display: none;
    }

    tr:hover .item-actions {
        display: flex;
    }

    .container{
      text-align: center;
    }

    .pr {
      margin-right: 300px;
    }
    
    button {
        float: right;
        padding: 5px 10px;
        border: unset;
        color: #212121;
        z-index: 1;
        background: #e8e8e8;
        position: relative;
        font-weight: 1000;
        font-size: 14px;
        transition: all 250ms;
        overflow: hidden;
    }

    button::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        width: 0;

        background-color: #1c96c5;
        z-index: -1;
        transition: all 250ms;
    }

    button:hover {
        color: #e8e8e8;
    }

    button:hover::before {
        width: 100%;
    }
    .table-bordered th {
        background-color: #1c96c5;
    }
</style>


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
<link rel="stylesheet" href="{% static 'css/request.css' %}">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">


<div class="container-fluid" style=" height: 74vh; overflow-y: auto; overflow-x: hidden;">

    <div class="container">
        <h1 class="pr text-center pt-4"> PURCHASE REQUEST</h1>
    </div>

    <div class="row">
        <div class="col-md-1 mb-0">
            <div class="ppmp">
                <button class="btn btn-primary">
                    <a href="{% url 'approved_ppmp'  %}" style="color: white; text-decoration: none;">  PPMP </a>
                </button>
            </div>
        </div>
    </div>

    <form action="{% url 'purchase' %}" method="post" enctype="multipart/form-data">
        {% csrf_token %}

    <table class="table table-bordered">
        <thead>
          <tr>
            <th>Item Name</th>
            <th>Brand / Description</th>
            <th>Unit</th>
            <th>Unit Price</th>
            <th></th>
            
          </tr>
        </thead>
        <tbody>

          {% for item in items %}
          <tr>
            <td>{{ item.item }} <input type="text" name="item" value="{{ item.item }}" style="display:none;" id="item_{{ item.id }}"></td>
            <td>{{ item.item_brand_description }} <input type="text" name="item_brand" value="{{ item.item_brand_description }}" style="display:none;" id="item_brand_{{ item.id }}"></td>
            <td>{{ item.unit }} <input type="text" name="unit" value="{{ item.unit }}" style="display:none;" id="unit_{{ item.id }}"></td>
            <td>{{ item.unit_cost }} <input type="text" name="unit_cost" value="{{ item.unit_cost }}" style="display:none;" id="unit_cost_{{ item.id }}"></td>
            <td>
                <div class="file-attachment">
                    <label for="fileInput{{ item.id }}" style="cursor: pointer;">
                        <img src="{% static 'images/link.png' %}" alt="Attach File">
                    </label>
                    <input type="file" id="fileInput{{ item.id }}" name="file" accept=".pdf, .doc, .docx" style="display: none;">
                </div>
            </td>
          </tr>
          {% endfor %}

            
    
        </tbody>
      </table>
    
    <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Attach click event to the icon, which will trigger the hidden file input
                document.querySelectorAll('.file-attachment label').forEach(function (label) {
                    label.addEventListener('click', function () {
                        var inputId = this.getAttribute('for');
                        document.getElementById(inputId).click();
                    });
                });
        
                // Attach change event to the file input elements
                document.querySelectorAll('.file-attachment input[type="file"]').forEach(function (fileInput) {
                    fileInput.addEventListener('change', function () {
                        // Handle the file attachment here
                        var fileName = this.files[0].name;
                        console.log('Selected file:', fileName);
                    });
                });
            });
     
      $(document).ready(function () {
        function calculateTotal() {
          var totalAmount = 0;
          $(".item_total_cost").each(function () {
            var itemCost = parseFloat($(this).text());
            totalAmount += itemCost;
          });
          $("#total_amount").text(totalAmount.toFixed(2));
        }

        calculateTotal();
      });
    </script>

    <footer class="fixed-bottom p-2" style="overflow-y: auto; overflow-x: hidden; background-color:  rgba(1, 33, 67, 0.9);">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-4">
            <div class="form-group">
              <label for="purpose" style="color:#FFFFFF">Purpose:</label>
              <textarea class="form-control" id="purpose" placeholder="Purpose" name="purpose" contenteditable="true"
                style="resize: vertical;"></textarea>
            </div>
          </div>
          <div class="col-md-4">
            <div class="text-center" style="color:#FFFFFF">
              <span>Total Amount: â‚±<span id="total_amount">0.00</span></span>
            </div>
          </div>
          <div class="col-md-4">
            <div class="text-right">
              <button type="submit" class="btn btn-primary">Submit</button>
            </div>
          </div>
        </div>
      </div>
    </footer>
    </form>
</div>

    

{% endblock %}