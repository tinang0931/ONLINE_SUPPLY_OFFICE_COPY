{% extends "accounts/User/sidebar.html" %}
{% load static %}

{% block purchase %}

<style>
  /* Table and Button Styles */
  .table-bordered th {
    background-color: #003566;
    color: white;
  }

  .item-actions {
    display: none;
  }


  .pp_mp {
    padding: 15px;
    border-radius: 8px;
    text-align: center;
  }

  .pp_mp button {
    background-color: #003566;
    color: #FFA500;
    border: 1px solid black;
    padding: 10px 20px;
    border-radius: 10px;
    transition: background-color 0.3s, color 0.3s;
    margin-bottom: 10px;
    width: 150%;
  }

  .pp_mp button a {
    color: inherit;
    text-decoration: none;
  }

  textarea.form-control {
    width: 100%;
    padding: 15px;
    margin-top: 5px;
    margin-right: 850px;
    resize: vertical;
    box-sizing: border-box;
    border: 2px solid #1c96c5;
    border-radius: 3%;
  }

  /* Submit Button Style */
  /* .col-md-4 .text-right button.btn.btn-primary {
    border-radius: 8%;
    background-color: #003566;
    border-color: #003566;
    height: 50px;
    width: 120px;
  } */

 
  .form-container {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      margin-top: 250px;
    }

    .form-container label {
      font-weight: bold;
      margin-right: 10px;
      color: #1c5d90;
    }

    .form-group {
      display: flex;
      flex: 1;
      align-items: center;
     
      
    }

    .form-group input, .form-group textarea {
    
      resize: vertical;
      width: 50%;
      padding: 10px;
      border: 1px solid #1c5d90;
      border-radius: 8px;
      font-size: 14px;
     
   
    }

/*   

    .total-amount {
      flex: 0.5;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .total-amount input {
      padding: 10px;
      border: 1px solid #1c5d90;
      border-radius: 8px;
      width: 100px;
      text-align: center;
      font-size: 16px;
      font-weight: bold;
    }

    .submit-button {
      flex: 0.5;
      display: flex;
      margin-right: 5px;
    }

    .submit-button button {
      background-color: #1c5d90;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
    } */

    .ctu_logo {
      position: relative;
      top: 3px;
      z-index: 1;
      left: -23px;
  }

  .head {
    color: white;
    font-family: 'Gill Sans', 'Gill Sans MT', 'Calibri', 'Trebuchet MS', sans-serif;
    margin-left: -3%;
    font-size: 48px;
      }
      .d-flex.flex-wrap.align-content-between.h-100 {
          background-color: #f3f4f5;
      }
      #sidebar-wrapper .list-group-item.logout-link {
        top: 230%; 
      }
      .navbar.bg-light {
          background-color: #003566 !important;
      }

/* Footer Container Styles */
.footer-container {
  position: fixed;
  bottom: 27px;
  width: 90%;
  background-color: #ffffff;
  padding: 8px;
  box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
  display: flex;
  justify-content: space-between; /* Aligns elements left and right */
  align-items: center;
  z-index: 952;
  box-sizing: border-box;
  margin-left: -15px;
}

.form-group {
  padding-left: 50px; 
}

.form-group label,
.form-group input {
  font-size: 16px; 
  color: black; 
}

.form-group label {
    font-weight: bold;
    margin-bottom: 5px;
    margin-right: 11px;
}

.form-group input {
  border: 1px solid black; /* Subtle gray border */
  border-radius: 4px; /* Slightly rounded corners */
  padding: 8px; /* Space inside the input */
  width: 100%; /* Takes full width of the container */
  box-sizing: border-box; /* Ensures padding doesn’t affect width */
  background: #f9f9f9; /* Light background for contrast */
  outline: none; /* Removes default focus outline */
  transition: border-color 0.3s, box-shadow 0.3s; /* Smooth focus effect */
  margin-bottom: -11px;
}


.form-group input:focus {
  border-color: #007bff; /* Blue border on focus */
  box-shadow: 0 0 5px rgba(0, 123, 255, 0.25); /* Subtle blue glow */
}

/* Align input field with other sections in footer */
.form-group {
  margin-right: 20px; /* Space between "Purpose" and next element */
}

/* Total Amount Styling */
.total-amount {
    flex: 1;
    display: flex;
    align-items: baseline;
    justify-content: flex-end;
}

.total-amount label {
  margin-right: 8px; /* Space between label and input */
  font-size: 14px; /* Adjust font size */
  font-weight: bold; /* Makes label stand out */
  margin-left: 47px;
}

.total-amount input {
  border: 1px solid black; /* Light gray border for a subtle look */
  font-size: 14px;
  background: #f9f9f9; /* Light background for contrast */
  color: #333; /* Darker text color */
  width: 100px; /* Fixed width for consistent layout */
  text-align: center; /* Align text to the right */
  padding: 5px; /* Adds spacing inside the input */
  border-radius: 4px; /* Slightly rounded corners */
  box-shadow: none; /* Removes any default shadow */
  outline: none; /* Removes the outline when focused */
  transition: border-color 0.3s, box-shadow 0.3s; /* Smooth focus effect */
}


/* Submit Button Styling */
.submit-btn {
  background: none; /* Removes background */
  color: #003566; /* Primary blue for text */
  padding: 7px 20px; /* Adjust padding for compact size */
  border: 1px solid #003566; /* Border matches text color */
  border-radius: 3px; /* Slightly less rounded corners */
  font-size: 14px; /* Comfortable font size */
  font-weight: bold; /* Makes text stand out */
  cursor: pointer; /* Pointer cursor on hover */
  transition: color 0.3s, border-color 0.3s, transform 0.2s; /* Smooth hover effect */
  margin-left: 47px;
}

.submit-btn:hover {
  color: #0056b3; /* Darker blue on hover */
  border-color: #0056b3; /* Darker border on hover */
  transform: scale(1.05); /* Slight zoom-in effect */
}

.submit-btn:active {
  color: #003f7f; /* Darker blue when clicked */
  border-color: #003f7f; /* Matches text color */
  transform: scale(1); /* Removes zoom effect */
}

.submit-btn:focus {
  outline: none; /* Removes default focus outline */
  box-shadow: 0 0 5px rgba(0, 123, 255, 0.5); /* Subtle blue glow */
}

</style>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<div id="page-content-wrapper ">
  <nav class=" bg-light"></nav>
</div>

<div class="container-fluid" style="height: 68vh; overflow-y: auto; overflow-x: hidden;">
  <div class="row mt-3">
    <div class="col-md-1 mb-0">
      <div class="pp_mp">
        <a href="{% url 'approved_ppmp' %}" style="text-decoration: none;">
          <button class="btn btn-primary">
          2024 PPMP
          </button>
        </a>
      </div>
    </div>
  </div>

  <!-- Form with Table -->
  <form action="{% url 'purchase' %}" method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Item Name</th>
          <th>Brand / Description</th>
          <th>Unit</th>
          <th>Unit Price</th>
          <th>Quantity</th>
          <th>Attachment</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
        <tr>
          <td class="text-left">{{ item.item }} <input type="text" name="items[]" value="{{ item.item }}" style="display:none;" id="item_{{ item.id }}"></td>
          <td class="text-left">{{ item.item_brand_description }} <input type="text" name="item_brands[]" value="{{ item.item_brand_description }}" style="display:none;" id="item_brand_{{ item.id }}"></td>
          <td>{{ item.unit }} <input type="text" name="units[]" value="{{ item.unit }}" style="display:none;" id="unit_{{ item.id }}"></td>
          <td>{{ item.unit_cost }} <input type="text" name="prices[]" value="{{ item.unit_cost }}" style="display:none;" id="unit_cost_{{ item.id }}"></td>
          <td style="text-align: center;"><input type="number" value="0" name="quantity[]" style="width: 40px;"></td>
          <td>
            <div class="file-attachment" style="margin-left: 10vh; ">
              <label for="fileInput{{ item.id }}" style="cursor: pointer;">
                <img src="{% static 'images/link.png' %}" alt="Attach File">
              </label>
              <input type="file" id="fileInput{{ item.id }}" name="files[]" accept=".pdf, .doc, .docx" style="display: none;">
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </form>


  <footer class="footer-container">
    <div class="form-group">
      <label for="purpose">Purpose:</label>
      <input type="text" id="purpose" name="purpose" placeholder="Enter purpose..." />
    </div>
  
    <div class="total-amount">
      <label for="totalAmount">Total Amount:</label>
      <input type="text" id="totalAmount" name="totalAmount" readonly value="₱0.00">
    </div>
  
    <div class="submit-button">
      <button type="submit" class="submit-btn">Submit</button>
    </div>
  </footer>
  
  
  

<!-- Scripts for Dynamic Calculations -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('input[name="prices[]"]').forEach(function (unitCostInput) {
      unitCostInput.addEventListener('change', function () {
        calculateTotal();
      });
    });

    document.querySelectorAll('input[name="quantity[]"]').forEach(function (quantityInput) {
      quantityInput.addEventListener('input', function () {
        calculateTotal();
      });
    });

    calculateTotal();

    function calculateTotal() {
      var totalAmount = 0;
      $('input[name="prices[]"]').each(function (index) {
        var itemCost = parseFloat($(this).val());
        var quantity = parseInt($('input[name="quantity[]"]').eq(index).val()) || 0;
        if (!isNaN(itemCost)) {
          totalAmount += itemCost * quantity;
        }
      });
      $("#total_amount").text(totalAmount.toFixed(2));
    }
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.file-attachment label').forEach(function (label) {
      label.addEventListener('click', function (event) {
        event.preventDefault();
        var inputId = this.getAttribute('for');
        var fileInput = document.getElementById(inputId);
        if (!fileInput.value) {
          fileInput.click();
        }
      });
    });

    document.querySelectorAll('.file-attachment input[type="file"]').forEach(function (fileInput) {
      fileInput.addEventListener('change', function () {
        var fileName = this.files[0].name;
        console.log('Selected file:', fileName);
      });
    });
  });
</script>

{% endblock %}