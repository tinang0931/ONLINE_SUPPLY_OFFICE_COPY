{% extends "accounts/User/main2.html" %}

{% load static %}

{% block ppmp %}


<div class="ppmp">
  <div class="row mt-3">
    <div class="col-md-1 mb-0">
      <div class="pp_mp">
        <a href="{% url 'approved_ppmp' %}" style="text-decoration: none;">
          <button class="btn btn-primary">
          2024 PPMP
          </button>
        </a>
      </div>
    </div>
  </div>

  <!-- Form with Table -->
  <form action="{% url 'purchase' %}" method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Item Name</th>
          <th>Brand / Description</th>
          <th>Unit</th>
          <th>Unit Price</th>
          <th>Quantity</th>
          <th>Attachment</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
        <tr>
          <td class="text-left">{{ item.item }} <input type="text" name="items[]" value="{{ item.item }}" style="display:none;" id="item_{{ item.id }}"></td>
          <td class="text-left">{{ item.item_brand_description }} <input type="text" name="item_brands[]" value="{{ item.item_brand_description }}" style="display:none;" id="item_brand_{{ item.id }}"></td>
          <td>{{ item.unit }} <input type="text" name="units[]" value="{{ item.unit }}" style="display:none;" id="unit_{{ item.id }}"></td>
          <td>{{ item.unit_cost }} <input type="text" name="prices[]" value="{{ item.unit_cost }}" style="display:none;" id="unit_cost_{{ item.id }}"></td>
          <td style="text-align: center;"><input type="number" value="0" name="quantity[]" style="width: 40px;"></td>
          <td>
            <div class="file-attachment" style="margin-left: 10vh; ">
              <label for="fileInput{{ item.id }}" style="cursor: pointer;">
                <img src="{% static 'images/link.png' %}" alt="Attach File">
              </label>
              <input type="file" id="fileInput{{ item.id }}" name="files[]" accept=".pdf, .doc, .docx" style="display: none;">
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
<!-- Purpose and Total/Submit Container -->

<div class="totalfooter">
  <div class="form-group">
    <label for="purpose">Purpose:</label>
    <input type="text" id="purpose" name="purpose" placeholder="Enter purpose..." />
  </div>
  <div class="total-amount" style="margin-right: 20px; ">
      <label for="totalAmount">Total Amount:</label>
      <input type="text" id="totalAmount" name="totalAmount" readonly value="â‚±0.00">
    </div>
      <div class="submit-button">
        <button type="submit">Submit</button>
      </div>
</div>


    
  </form>
</div>

<!-- Scripts for Dynamic Calculations -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('input[name="prices[]"]').forEach(function (unitCostInput) {
      unitCostInput.addEventListener('change', function () {
        calculateTotal();
      });
    });

    document.querySelectorAll('input[name="quantity[]"]').forEach(function (quantityInput) {
      quantityInput.addEventListener('input', function () {
        calculateTotal();
      });
    });

    calculateTotal();

    function calculateTotal() {
      var totalAmount = 0;
      $('input[name="prices[]"]').each(function (index) {
        var itemCost = parseFloat($(this).val());
        var quantity = parseInt($('input[name="quantity[]"]').eq(index).val()) || 0;
        if (!isNaN(itemCost)) {
          totalAmount += itemCost * quantity;
        }
      });
      $("#total_amount").text(totalAmount.toFixed(2));
    }
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.file-attachment label').forEach(function (label) {
      label.addEventListener('click', function (event) {
        event.preventDefault();
        var inputId = this.getAttribute('for');
        var fileInput = document.getElementById(inputId);
        if (!fileInput.value) {
          fileInput.click();
        }
      });
    });

    document.querySelectorAll('.file-attachment input[type="file"]').forEach(function (fileInput) {
      fileInput.addEventListener('change', function () {
        var fileName = this.files[0].name;
        console.log('Selected file:', fileName);
      });
    });
  });
</script>

{% endblock %}