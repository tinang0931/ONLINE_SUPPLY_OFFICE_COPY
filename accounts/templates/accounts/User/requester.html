{% extends "accounts/User/main.html" %}

{% load static %}

{% block content %}
        <div class="container-fluid" style=" height: 68vh; overflow-y: auto; overflow-x: hidden; ">
          <div class="container">
            <h1 class="pr text-center pt-4">CREATE PURCHASE REQUEST</h1>  
          </div>
          <form action="{% url 'requester' %}" method="post">
            {% csrf_token %}
            <div class="row w-100 m-auto"> 
              <div class="col-12 col-sm-12 col-md-6 col-lg-4 ps-0">
                <div class="form-group mb-3">
                  <label for="departmentDropdown">Choose Department:</label>
                  <select class="form-control" id="departmentDropdown" name="departmentDropdown">
                      <option value="option1">College of Arts and Sciences</option>
                      <option value="option2">College of Agriculture</option>
                      <option value="option3">College of Forestry</option>
                      <option value="option4">College of Hospitality Management and Tourism</option>
                      <option value="option5">College of Technology and Engineering</option>
                      <option value="option6">College of Education</option>
                      <option value="option7">Graduate School</option>
                      <option value="option8">  Others please specify:</option>
                  </select>
                </div>
              </div>

              <div class="col-12 col-sm-12 col-md-6 col-lg-4 ps-0">
                <div class="form-group mb-3">
                  <label for="exampleFormcontrolTextarea1 p-2">Purpose</label>
                  <textarea class="form-control" id="exampleFormcontrolTextarea1" name="item_purpose" rows="1"></textarea>
                </div>
              </div>
            
            </div> 

            <div class="row w-100 m-auto mb-3">
              <div class="col-6 col-sm-6 col-md-7 col-lg-9">
                <!-- Button trigger modal -->
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                  Select Items
                </button>

                <!-- Modal -->
                <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">New Request</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body"></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-6 col-sm-6 col-md-5 col-lg-3">
                <input class="form-control" type="text" placeholder="Search"  id="search_bar_request">
              </div>
            </div>
            <div class="table-responsive">

              <table class="table" id="create_request_table" style="border: 1px solid black;">
                <thead>
                    <tr>
                        <th class="text-nowrap">Item No.</th>
                        <th class="text-nowrap" style="min-width: 15rem;">Item Name</th>
                        <th class="text-nowrap" style="min-width: 7rem;">Item Brand/Description</th>
                        <th class="text-nowrap" style="min-width: 7rem;">Unit</th>
                        <th class="text-nowrap" style="min-width: 7rem;">Unit Cost</th>
                        <th class="text-nowrap" style="min-width: 7rem;">Quantity</th>
                        <th class="text-nowrap" style="min-width: 7rem;">Total Cost</th>
                        <th class="text-center text-nowrap"></th>
                    </tr>
                </thead>
                <tbody>
                  <tr class="item-row">
                    <td style="text-align: center;"><span class="item-no">1</span></td>
                    <td>System Unit</td>
                    <td>3310 - A "system unit" is the main body or housing of a desktop computer where all the key internal components are housed.</td>
                    <td>Set</td>
                    <td><span class="unit-price">10.00</span></td>
                    <td><input type="number" class="quantity" min="1" oninput="calculateRowTotal(this)"></td>
                    <td><span class="total">0.00</span></td>
                    <td class="text-end my-2 mt-0">
                      <div class="d-flex justify-content-evenly">
                        <button type="button" class="btn"><i class="fas fa-trash" style="color: red !important;"></i></button>
                      </div>
                    </td>
                  </tr>
                  <tr class="item-row">
                    <td style="text-align: center;"><span class="item-no">2</span></td>
                    <td>Camera</td>
                    <td>Logitech - Common features include HD or even 4K resolution, autofocus, built-in microphones, and software enhancements for video quality.</td>
                    <td>piece</td>
                   <td><span class="unit-price">10.00</span></td>
                    <td><input type="number" class="quantity" min="1" oninput="calculateRowTotal(this)"></td>
                    <td><span class="total">0.00</span></td>
                    <td class="text-end my-2 mt-0">
                      <div class="d-flex justify-content-evenly">
                        <button type="button" class="btn"><i class="fas fa-trash" style="color: red !important;"></i></button>
                      </div>
                    </td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <td colspan="6">Total Amount</td>
                    <td><span id="totalAmount">0.00</span></td>
                    <td>
                      <button type="button" class="btn btn-primary">Submit</button>
                    </td>
                  </tr>
                </tfoot>
            </table>
            </div>

          </form>
        </div>          

      </div>
          
    <script>
  // Update department name in the hidden input field
  const departmentDropdown = document.getElementById('departmentDropdown');
  departmentDropdown.addEventListener("change", function () {
      const selectedOption = departmentDropdown.options[departmentDropdown.selectedIndex];
      const selectedOptionText = selectedOption.textContent;
      const selectedDepartmentNameInput = document.getElementById('selectedDepartmentName');
      selectedDepartmentNameInput.value = selectedOptionText;
  });
</script>

<script>
  function calculateRowTotal(input) {
    const row = input.parentNode.parentNode;
    const unitPrice = parseFloat(row.querySelector('.unit-price').textContent) || 0;
    const quantity = parseInt(input.value) || 0;

    const totalAmount = unitPrice * quantity;
    row.querySelector('.total').textContent = totalAmount.toFixed(2);

    calculateTotalAmount();
  }

  function calculateTotalAmount() {
    const totalElements = document.querySelectorAll('.total');
    let totalAmount = 0;

    totalElements.forEach(element => {
      totalAmount += parseFloat(element.textContent);
    });

    document.getElementById('totalAmount').textContent = totalAmount.toFixed(2);
  }
</script>

{% endblock %}  
  
