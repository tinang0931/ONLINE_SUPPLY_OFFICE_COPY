{% extends "accounts/User/main.html" %}

{% load static %}

{% block ppmp %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/ppmp.css' %}">
{% endblock extra_css %}

<div class="bck">
    <a href="{% url 'ppmp101' %}">
        <img src="{% static 'images/back2.png' %}" alt="Previous">
    </a>
</div>

<div class="row">
    <div class="col-md-1 mb-0">
        <a href="{% url 'catalogue' %}" style="color: #FFA500; text-decoration: none; position: relative; display: flex; gap: 5px; margin-bottom: 10px;">
            <button class="catalogue"><strong>CATALOGUE</strong></button>
            <button class="catalogue"><strong>2020 PPMP</strong></button>
            <button class="catalogue"><strong>2021 PPMP</strong></button>
            <button class="catalogue"><strong>2022 PMMP</strong></button>
            <button class="catalogue"><strong>2023 PPMP</strong></button>
            <button class="catalogue"><strong>2024 PPMP</strong></button>
        </a>
    </div>

    <div class="row mt-4">
        <div class="col-md-4 mb-0">
            <form id="ppmpForm" action="{% url 'ppmp' %}" method="post">
                {% csrf_token %}
                <div style="position: relative; z-index: 999;">
                    <select id="yearDropdown">
                        <option selected>Select Year</option>
                        {% for year in "2022,2023,2024,2025,2026,2027"|split:"," %}
                            <option value="{{ year }}">{{ year }}</option>
                        {% endfor %}
                    </select>
                    <input type="hidden" id="selectedYear" name="selectedYear">
                    <script>
                        document.getElementById("yearDropdown").addEventListener("change", function () {
                            document.getElementById("selectedYear").value = this.value;
                        });
                    </script>
                </div>
            </form>
        </div>

        <div class="col-md-5 mb-0 text-left" style="top: 50px;">
            <div class="budget-container">
                <strong>Total Allocated Budget:</strong>
                <span id="total_allocated_budget"><b>â‚± 15000.00</b></span>
            </div>
        </div>
    </div>

    <div class="table-responsive" style="margin: 0 auto; margin-top: 5vh;">
        <table class="table table-bordered text-center mt-4">
            <thead>
                <tr>
                    <th rowspan='2' class="text-center"></th>
                    <th rowspan='2' class="text-center">Item Name</th>
                    <th rowspan='2' class="text-center">Brand / Description</th>
                    <th rowspan='2' class="text-center">Unit</th>
                    <th rowspan='2' class="text-center">Estimated Budget</th>
                    <th colspan="12" class="text-center">Monthly Quantity Requirement</th>
                    <th rowspan='2' class="text-center">Unit Price</th>
                    <th rowspan="2" class="text-center">Action</th>
                </tr>
                <tr>
                    {% for month in "Jan,Feb,Mar,April,May,June,July,Aug,Sept,Oct,Nov,Dec"|split:"," %}
                        <th>{{ month }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for p in items %}
                <tr class="item-row" id="{{ p.id }}">
                    <td class="text-center">{{ forloop.counter }}</td>
                    <td class="text-left">
                        <span class="editable" data-field="Item_name">{{ p.item }}</span>
                        <input id="item_{{ p.id }}" name="item" type="text" value="{{ p.item }}" oninput="change_val('item_{{ p.id }}')" class="edit-input" style="display: none">
                    </td>
                    <td class="text-left">
                        <span class="editable" data-field="Item_Brand">{{ p.item_brand_description }}</span>
                        <input id="item_brand_{{ p.id }}" name="item_brand" type="text" value="{{ p.item_brand_description }}" oninput="change_val('item_brand_{{ p.id }}')" class="edit-input" style="display: none">
                    </td>
                    <td class="text-left">
                        <span class="editable" data-field="Unit">{{ p.unit }}</span>
                        <input id="unit_{{ p.id }}" name="unit" type="text" value="{{ p.unit }}" oninput="change_val('unit_{{ p.id }}')" class="edit-input" style="display: none">
                    </td>
                    <td><input type="number" name="estimate_budget"></td>
                    {% for month in "jan,feb,mar,apr,may,jun,jul,aug,sep,oct,nov,dec"|split:"," %}
                        <td><input type="number" style="width: 38px;" name="{{ month }}" value="0"></td>
                    {% endfor %}
                    <td>
                        <span class="editable" data-field="Price">{{ p.unit_cost }}</span>
                        <input id="price_{{ p.id }}" name="price" type="number" value="{{ p.unit_cost }}" oninput="change_val('price_{{ p.id }}')" class="edit-input" style="display: none">
                    </td>
                    <td>
                        <div class="item-actions" style="margin-left: 17px;">
                            {% if p.id %}
                                <a href="{% url 'delete' p.id %}" class="delete-icon delete-item" data-id="{{ p.id }}">
                                    <i class="fas fa-trash text-danger"></i>
                                </a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Add Item Button -->
        <button type="button" class="add-btn btn-primary btn-sm float-left mt-2 mb-2" id="add-btn-{{ category }}" onclick="toggleNewItemRow('{{ category }}')">
            <i class="fas fa-plus-circle"></i>
        </button>

        <button id="submitBtn" type="button" class="btn btn-success btn-sm m-2" style="color: #FFA500; background-color: #22507A; border-color: #007bff; height: 43px; width: 130px; position: fixed; top: 85vh; right: 20px;" onclick="submitForm()">
            <i class="fas fa-check-circle"></i> Submit
        </button>

        <!-- Total Amount -->
        <div class="total" style="position: absolute; top: 50vh; left: 150vh; transform: translateX(-50%); display: flex; align-items: center;">
            <label for="estimate_budget" style="margin-right: 10px;"><strong>TOTAL AMOUNT :</strong></label>
            <input type="number" name="estimate_budget" id="estimate_budget" readonly>
        </div>
        
        <!-- JavaScript -->
        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
        <script>
            function toggleNewItemRow(category) {
                var newRow = document.getElementById('new-item-row-' + category);
                newRow.style.display = newRow.style.display === 'none' ? 'table-row' : 'none';
            }

            // Other functions as needed...
        </script>

    {% endblock %}