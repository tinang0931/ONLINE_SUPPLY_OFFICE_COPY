{% extends "accounts/User/main.html" %}


{% load static %}


{% block myppmp %}

<style>
    .table-bordered th {
        background-color: #1c96c5;
    }

    .item-actions {
        display: none;
    }

    tr:hover .item-actions {
        display: flex;
    }
    .dropdown {
        position: relative;
        display: inline-block;
    }
    .transparent-bg {
        background-color: transparent !important;
        border-color: transparent !important;
    }
    .transparent-bg:focus,
    .transparent-bg:active {
        outline-color: transparent !important;
        box-shadow: none !important;
    }
    .dots {
        font-size: 14px;
        color: #1c96c5;
    }
    
    #textContainer {
        position: absolute;
        top: 100%;
        left: 0;
        background-color: #ffffff;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
        padding: 1px;
    }
    .dropdown:hover #textContainer {
        display: block;
    }

    .dropdown:hover #textContainer a {
        color: #FFA600;
    }
    element.style {
        border: 2px solid #05708BD2;
    }
    .form-control {
        display: block;
        width: 18%;
        padding: .375rem .75rem;
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        color: var(--bs-body-color);
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background-clip: padding-box;
        border-radius: 20px;
        transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
        margin-left: auto; /* Set margin-left to auto for right alignment */
        margin-right: 10px; /* Add margin-right for spacing */
        background-color: transparent;
        box-shadow: none;
    }
      body{
        overflow:hidden;
      }
      html{
        overflow:hidden;
      }
    
</style>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

<link rel="stylesheet" href="{% static 'css/request.css' %}">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">


<div class="container-fluid" style="height: 68vh; overflow-y: auto; overflow-x: hidden;">
    <h1 class="pr text-center pt-4">PROJECT PROCUREMENT MANAGEMENT PLAN</h1>
    
    <div class="search" style="position: relative; display: flex; align-items: center; justify-content: flex-start; margin-left: 1531px; margin-top: 1%;">
        <i class="fas fa-search" style="position: absolute; left: 9vh; color: #1c96c5; border-radius: 25px;"></i>
        <input class="form-control mb-3 pr-5 pl-5" type="text" placeholder="Search Username or Date" id="search_bar_request" oninput="filterTable()" style="border: 2px solid #1c96c5; flex: 1; border-radius: 25px; ">
    </div>
    
    
    <div class="row">

        <div class="col-md-1 mb-0">
            <div class="dropdown">
                <button class="btn btn-primary transparent-bg" onclick="toggleText()" style="margin-top: 0px;">
                    <span class="dots">&#8226;&#8226;&#8226;</span>
                </button>
                <div id="textContainer" style="display: none; width: 98px; text-align: center; background-color: #fc8f01;">
                    <a href="{% url 'ppmp' %}" style="color: black; text-decoration: none; white-space: nowrap;">Create PPMP</a>
                </div>
            </div>
        </div>
    </div>

    <div class="table-responsive">


        <table class="table table-bordered" style="margin-top: 1px;">
                <thead>
                    <tr>
                    <tr>
                        <th rowspan='2'>Item Name</th>
                        <th rowspan='2'> Brand / Description</th>
                        <th rowspan='2'>Unit</th>
                        <th rowspan='2'>Estimated Budget</th>
                        <th colspan="12">Monthly Quantity Requirement</th>
                        <th rowspan='2'>Unit Price</th>
                        
                    </tr>
                    <tr>
                        <th>Jan</th>
                        <th>Feb</th>
                        <th>Mar</th>
                        <th>April</th>
                        <th>May</th>
                        <th>June</th>
                        <th>July</th>
                        <th>Aug</th>
                        <th>Sept</th>
                        <th>Oct</th>
                        <th>Nov</th>
                        <th>Dec</th>
                    </tr>

                    </tr>
                </thead>
                <tbody>
                    {% for p in items %}

                  
                        <tr class="item-row" id="{{ p.id }}">

                            <td>
                                <span class="editable" data-field="Item_name">{{ p.item }}</span>
                                <input id="item_{{ p.id }}" name="item" type="text" value="{{ p.item }}"
                                    oninput="change_val('item_{{ p.id }}')" class="edit-input" style="display: none">
                            </td>
                            <td>
                                <span class="editable" data-field="Item_Brand">{{ p.item_brand_description }}</span>
                                <input id="item_brand_{{ p.id }}" name="item_brand" type="text" value="{{ p.item_brand_description }}"
                                    oninput="change_val('item_brand_{{ p.id }}')" class="edit-input"
                                    style="display: none">
                            </td>
                            <td>
                                <span class="editable" data-field="Unit">{{ p.unit }}</span>
                                <input id="unit_{{ p.id }}" name="unit" type="text" value="{{ p.unit }}"
                                    oninput="change_val('unit_{{ p.id }}')" class="edit-input" style="display: none">
                            </td>
                            <td>{{ p.estimate_budget }}</td>
                            <td>{{ p.jan }}</td>
                            <td>{{ p.feb }}</td>
                            <td>{{ p.mar }}</td>
                            <td>{{ p.apr }}</td>
                            <td>{{ p.may }}</td>
                            <td>{{ p.jun }}</td>
                            <td>{{ p.jul }}</td>
                            <td>{{ p.aug }}</td>
                            <td>{{ p.sep }}</td>
                            <td>{{ p.oct }}</td>
                            <td>{{ p.nov }}</td>
                            <td>{{ p.dec }}</td>


                           

                            <td>
                                <span class="editable" data-field="Price">{{ p.unit_cost }}</span>
                                <input id="price_{{ p.id }}" name="price" type="number" value="{{ p.unit_cost }}"
                                    oninput="change_val('price_{{ p.id }}')" class="edit-input" style="display: none">
                            </td>

                        </tr>
               
                    {% endfor %}

                </tbody>
            </table>
      
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>



    $(document).ready(function () {

        function updateEstimateBudgetForRow(row) {

            var unitPrice = parseFloat(row.find('[name="price"]').val());


            var totalValue = 0;


            row.find('[name^="jan"], [name^="feb"], [name^="mar"], [name^="apr"], [name^="may"], [name^="jun"], [name^="jul"], [name^="aug"], [name^="sep"], [name^="oct"], [name^="nov"], [name^="dec"]').each(function () {
                var monthValue = parseFloat($(this).val()) || 0;
                totalValue += monthValue;
            });


            var estimateBudget = totalValue * unitPrice;


            row.find('[name="estimate_budget"]').val(estimateBudget.toFixed(2));
        }


        $('[name^="jan"], [name^="feb"], [name^="mar"], [name^="apr"], [name^="may"], [name^="jun"], [name^="jul"], [name^="aug"], [name^="sep"], [name^="oct"], [name^="nov"], [name^="dec"]').on('input', function () {

            var row = $(this).closest('tr.item-row');
            updateEstimateBudgetForRow(row);
        });


        $('[name="price"]').on('input', function () {

            var row = $(this).closest('tr.item-row');
            updateEstimateBudgetForRow(row);
        });
    });


</script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<script>
    function toggleText() {
        var textContainer = document.getElementById("textContainer");
        textContainer.style.display = (textContainer.style.display === "none" || textContainer.style.display === "") ? "block" : "none";
    }
</script>

{% endblock %}