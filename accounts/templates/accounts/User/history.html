{% extends "accounts/User/main.html" %}

{% load static %}

{% block history %}

        <div class="container-fluid" style=" height: 68vh; overflow-y: auto; overflow-x: hidden;">
          <div class="container">
            <h1 class="pr text-center pt-4">PURCHASE REQUEST HISTORY</h1>  
          
          <!-- Modal -->
  <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="form-group mb-1">
            <label for="exampleFormcontrolTextarea1 p-2">Purchase Request ID</label>
            <input type="text" class="form-control item-name" name="item_name[]">
          </div>
          <div class="form-group mb-1">
            <label for="exampleFormcontrolTextarea1 p-2">Date Requested</label>
            <textarea class="form-control item-description" name="item_description[]" rows="1"></textarea>
          </div>
          <div class="form-group mb-1">
            <label for="exampleFormcontrolTextarea1 p-2">Purpose</label>
            <input type="text" class="form-control unit" name="unit[]">
          </div>
          <div class="form-group mb-1">
            <label for="exampleFormcontrolTextarea1 p-2">Status</label>
            <input type="number" class="form-control quantity" min="1" oninput="calculateRowTotal(this)" name="quantity[]">
          </div>
          <div class="form-group mb-1">
            <label for="exampleFormcontrolTextarea1 p-2">Status Description</label>
            <input type="number" class="form-control unit-cost" name="unit_cost[]" min="00.00" step="00.00" oninput="calculateRowTotal(this)">
          </div>
          
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary">Add</button>
        </div>
      </div>
    </div>
  </div>
</div>

  
  <div class="col-6 col-sm-6 col-md-5 col-lg-3">
    <input class="form-control" type="text" placeholder="Search" id="search_bar_request">
  </div>
  
  <div class="table-responsive" style="margin: 0 auto;">
    <table class="table" id="create_request_table" style="border: 1px solid black;">
</div>
<div class="table-responsive" style="margin: 0 auto;">
  <table class="table" id="create_request_table" style="border: 1px solid black;">
<div class="table-responsive">

<table class="table" id="create_request_table" style="border: 1px solid black;">
  <thead>
      <tr>
          <th class="text-nowrap" style="min-width: 15rem;">Purchase Request ID</th>
          <th class="text-nowrap" style="min-width: 7rem;">Date Requested</th>
          <th class="text-nowrap" style="min-width: 7rem;">Purpose</th>
          <th class="text-nowrap" style="min-width: 7rem;">Quantity</th>
          <th class="text-nowrap" style="min-width: 7rem;">Status</th>
          <th class="text-nowrap" style="min-width: 7rem;">Status Description</th>
          <th class="text-nowrap" style="min-width: 7rem;">Amount</th>
          <th class="text-center text-nowrap"></th>
      </tr>
  </thead>
  <tbody>
    
    <tr class="item-row">
      <td style="text-align: center;">
        <span class="item-no">0000100</span>
      </td>
      <td>09-30-2023</td>
      <td>Purchase Dell Laptop Order</td>
      <td>1 unit</td>
      <td>pending approval</td>
      <td>Verify Papers submitted</td>
      <td><span class="total">1,200,000</span></td>
      <td class="text-end my-2 mt-0">
        <link rel="stylesheet" type="text/css" href="{% static 'print.css' %}" media="print">

        <button type="button" class="btn btn-success me-2" onclick="printRequestForm()">
          <i class="fas fa-print"></i> View
        </button>
        
        <script>
          function printRequestForm() {
            // Get the form element by ID
            var requestForm = document.getElementById('requestForm');
        
            // Open a new window and write the form HTML into it
            var printWindow = window.open('', '_blank');
            printWindow.document.write('<html><head><title>Print</title>');
            printWindow.document.write('</head><body>');
            printWindow.document.write(requestForm.outerHTML);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
        
            // Print the new window
            printWindow.print();
          }
        </script>
        
    <button type="button" class="btn btn-link btn-sm show-details-btn" data-request-id="0000102">
        Show More Details
    </button>
    <script>
document.querySelectorAll('.show-details-btn').forEach(function(button) {
    button.addEventListener('click', function() {
        var request_id = this.getAttribute('data-request-id');
        if (request_id) {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/show_more_details/', true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    // Update the user interface with the additional details
                    alert('Additional Details for Request ' + response.purchase_request_id + ':\n' + response.additional_details);
                } else {
                    alert('Error: ' + xhr.statusText);
                }
            };
            xhr.send('request_id=' + request_id);
        }
    });
});
</script>
      </td>
    </tr>
    
      </td>
</tbody>
</table>

  {% endblock %} 
