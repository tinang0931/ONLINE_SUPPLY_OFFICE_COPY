{% extends "accounts/User/main.html" %}

{% load static %}

{% block history %}

<div class="container-fluid" style=" height: 68vh; overflow-y: auto; overflow-x: hidden;">
  <div class="container">
    <h1 class="pr text-center pt-4">PURCHASE REQUEST HISTORY</h1>


    <div class="col-6 col-sm-6 col-md-5 col-lg-3">
      <input class="form-control" type="text" placeholder="Search" id="search_bar_request">
    </div>
    <div class="table-responsive" style="margin: 0 auto;">
        <table class="table" id="create_request_table" style="border: 1px solid black;">
          <thead>
            <tr>
              <th class="text-nowrap" style="min-width: 15rem;">Purchase Request ID</th>
              <th class="text-nowrap" style="min-width: 7rem;">Date Requested</th>
              <th class="text-nowrap" style="min-width: 7rem;">Item Name</th>
              <th class="text-nowrap" style="min-width: 7rem;">Quantity</th>
              <th class="text-nowrap" style="min-width: 7rem;">Status Description</th>
              <th class="text-nowrap" style="min-width: 7rem;">Amount</th>
              <th class="text-center text-nowrap"></th>
            </tr>
          </thead>
          <tbody>
            {% for item in items %}
            <tr class="item-row">
              <td style="text-align: center;">
                <span class="item-no">{{item.request_id}}</span>
              </td>
              <td>{{ item.submission_date }}</td>
              <td>{{item.item}}</td>
              <td>{{item.quantity}}</td>
              <td>Verify Papers submitted</td>
              <td><span class="total">{{ item.total_price }}</span></td>
              <td class="text-end my-2 mt-0">
                <html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <button type="button" class="btn btn-success me-2" onclick="window.location.href='request-url'">
      <i class="fas fa-print"></i> View
     </button>

</html>

                </div>
                <button type="button" class="btn btn-link btn-sm show-details-btn" data-request-id="0000102">
                  Show More Details
              </button>
              <script>
          document.querySelectorAll('.show-details-btn').forEach(function(button) {
              button.addEventListener('click', function() {
                  var request_id = this.getAttribute('data-request-id');
                  if (request_id) {
                      var xhr = new XMLHttpRequest();
                      xhr.open('POST', '/show_more_details/', true);
                      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                      xhr.onreadystatechange = function () {
                          if (xhr.readyState === 4 && xhr.status === 200) {
                              var response = JSON.parse(xhr.responseText);
                              // Update the user interface with the additional details
                              alert('Additional Details for Request ' + response.purchase_request_id + ':\n' + response.additional_details);
                          } else {
                              alert('Error: ' + xhr.statusText);
                          }
                      };
                      xhr.send('request_id=' + request_id);
                  }
              });
          });
          </script>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        
        </table>
    </div>
  </div>
</div>
{% endblock %} 
