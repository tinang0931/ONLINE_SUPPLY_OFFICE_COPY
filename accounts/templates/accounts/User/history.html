{% extends "accounts/User/main.html" %}

{% load static %}

{% block history %}

<div class="container-fluid" style="height: 68vh; overflow-y: auto; overflow-x: hidden;">
  <div class="container">
    <h1 class="pr text-center pt-4">PURCHASE REQUEST HISTORY</h1>

    <div class="col-6 col-sm-6 col-md-5 col-lg-3">
      <input class="form-control" type="text" placeholder="Search" id="search_bar_request">
    </div>

    <div class="table-responsive" style="margin: 0 auto;">
      <table class="table" id="create_request_table" style="border: 1px solid black;">
        <thead>
          <tr>
            <th class="text-nowrap" style="min-width: 15rem;">Purchase Request ID</th>
            <th class="text-nowrap" style="min-width: 7rem;">Date Requested</th>
            <th class="text-nowrap" style="min-width: 7rem;">Item Name</th>
            <th class="text-nowrap" style="min-width: 7rem;">Quantity</th>
            <th class="text-nowrap" style="min-width: 7rem;">Status Description</th>
            <th class="text-nowrap" style="min-width: 7rem;">Amount</th>
            <th class="text-center text-nowrap"></th>
          </tr>
        </thead>
        <tbody>
          {% regroup items by checkout_id as grouped_items %}
          {% for group in grouped_items %}
          <tr class="pr-row" data-pr-id="{{ group.grouper }}">
            <td style="text-align: center;">
              <span class="pr-no">{{ group.grouper }}</span>
            </td>
            {% for item in group.list %}
            <td>{{ item.submission_date }}</td>
            <td>{{ item.item }}</td>
            <td>{{ item.quantity }}</td>
            <td>Verify Papers submitted</td>
            <td><span class="total">{{ item.total_price }}</span></td>
            <td class="text-end my-2 mt-0">
              <div class="d-flex justify-content-start align-items-center">
                <button type="button" class="btn btn-success view-btn me-2">
                  <i class="fas fa-print"></i> View
                </button>
              </div>
              <div class="d-flex justify-content-start align-items-center" style="color: grey; margin-top: 5px;">
                <button type="button" class="btn btn-link btn-sm details-btn">Show More Details</button>
                <button type="button" class="btn btn-link btn-sm">
                </button>
              </div>
            </td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
        <div style="display: flex; justify-content: flex-end; margin-top: 20px; margin-right: 20px;">
          <button class="btn btn-primary" id="view-more-button" style="background-color: blue;">View More</button>
        </div>
      </table>
    </div>
  </div>
</div>

<script>
  $(document).ready(function () {
    // Hide all item rows initially
    $('.pr-row').find('.item-row').hide();

    // Toggle item rows when clicking on Purchase Request ID
    $('.view-btn').on('click', function () {
      var prRow = $(this).closest('.pr-row');
      prRow.find('.item-row').toggle();
    });

    // Add more JavaScript logic as needed
  });
</script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>




{% endblock %}