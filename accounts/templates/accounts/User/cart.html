



{% extends "accounts/Admin/BAC_Secretariat/nav.html" %}


{% load static %}


{% block cart %}

<style>
  .primary-btn {
      background-color: rgb(52, 129, 211); /* Set the primary color for the button */
      color: #ffffff; /* Set the text color for the button */
      padding: 10px 20px; /* Adjust padding as needed */
      border: none;
      border-radius: 5px;
      cursor: pointer;
      width: 120px;
  }

  .primary-btn:hover {
      background-color: #65a2e2; /* Change the color on hover if desired */
  }
</style>


<form action="{% url 'requester' %}" method="post">
    {% csrf_token %} 

    
    <div>
      <div class=" cart table-responsive" style="height: 68vh; overflow-y: auto; overflow-x: hidden; justify-content: center; margin-left: 40%; width: 100%; margin-top: 5%;" >
        <table class="cart_table" id="create_request_table" style="background-color: none; ">
          <thead style="background-color: rgba(0, 50, 102, 0.8);    font-size: 1.2rem; font-family: sans-serif; color: rgb(246, 239, 239); text-align: center; height: 3rem; border: 0.5px solid #060000">
            <tr>
                <th class="text-center text-nowrap" style="min-width: 15rem;">Item Name</th>
                <th class="text-center text-nowrap" style="min-width: 7rem;">Item Brand/Description</th>
                <th class="text-center text-nowrap" style="min-width: 7rem;">Unit</th>
                <th class="text-center text-nowrap" style="min-width: 7rem;">Unit Cost</th>
                <th class="text-center text-nowrap" style="min-width: 7rem;">Quantity</th>
                <th class="text-center text-nowrap" style="min-width: 7rem;">Total Cost</th>
                <th class="text-center text-nowrap" style="min-width: 7rem;"></th>
                <th class="text-center text-nowrap"></th>
                
            </tr>
        </thead>
        
            <tbody>
              {% for item in items %}
                  <tr  style="background-color: rgba(30, 150, 255, 0.3) !important; border-bottom: 0.2px solid rgba(0, 0, 0, 0.2);" >
                      <td class="item_name text-center">{{ item.item }}</td>
                      <td class="item_description text-center">{{ item.item_brand_description }} </td>
                      <td class="item_unit text-center">{{ item.unit }}</td>
                      <td class="item_unit_cost text-center">{{ item.unit_cost }}</td>
                      <td class="item_quantity text-center">{{ item.quantity }}</td>
                      <td class="item_total_cost text-center">{{ total_cost }}</td>
                      
                      <td class="text-center">
                          <button onclick="openModal()" style="background-color: transparent; border: none; size:50%; border-radius: 50%; color: rgb(1, 154, 72);">
                              <i class="fa fa-edit"></i>
                          </button>
                          <button class="delete-button" data-item-id="{{ item.id }}" onclick="deleteRow(this)" style="background-color: transparent; border: none; size:50%; border-radius: 50%; color: rgb(157, 2, 2);">
                            <i class="fa fa-trash"></i>
                        </button>
                      </td>
                      <td>
                        <input type="hidden" name="item_{{ item.id }}" value="{{ item.item }}">
                        <input type="hidden" name="item_brand_{{ item.id }}" value="{{ item.item_brand_description }}">
                        <input type="hidden" name="unit_{{ item.id }}" value="{{ item.unit }}">
                        <input type="hidden" name="quantity_{{ item.id }}" value="{{ item.quantity }}">
                        <input type="hidden" name="price_{{ item.id }}" value="{{ item.unit_cost }}">
                    </td>
                  </>
              {% endfor %}


          </tbody>
        </table>

        <div style="display: flex; align-items: center; margin-top: 10px;">
          <div>
              <textarea id="purpose" name="purpose" placeholder="Purpose" style="width: 500px; height: 100px; padding: 10px; border-radius: 10px;"></textarea>
          </div>
      
          <div style="margin-left: 30px; display: flex; flex-direction: column;">
              <label for="total_cost" style="margin-bottom: 5px;">Total Amount</label>
              <div style="border: 1px solid #000; padding: 10px; text-align: center; height: 40px; border-radius: 10px;">
                <span>{{ total_cost }}</span>
            </div>
            
          </div>
      
          <div style="margin-left: 325px; margin-top: 50px;">
              <button class="primary-btn" type="submit" name="submit_button">Submit</button>
          </div>
      </div>
      

      </div>
    </div>
</form>

<script>
  function deleteRow(button) {
      // Get the item ID from the data attribute
      var itemId = button.getAttribute('data-item-id');

      // Make sure the user confirms the deletion (optional)
      var confirmDelete = confirm('Are you sure you want to delete this item?');

      if (confirmDelete) {
          // Use fetch to send a POST request to the delete_item view
          fetch('/delete_item/' + itemId + '/', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
                  'X-CSRFToken': '{{ csrf_token }}'  // Include CSRF token if required
              },
              // body: JSON.stringify({})  // Include request body if needed
          })
          .then(response => response.json())
          .then(data => {
              // Handle the response from the server
              if (data.status === 'success') {
                  // Optionally, update the UI or perform other actions
                  console.log('Item deleted successfully');
              } else {
                  console.error('Failed to delete item:', data.message);
              }
          })
          .catch(error => {
              console.error('Error during fetch:', error);
          });
      }
  }
</script>


{% endblock %}