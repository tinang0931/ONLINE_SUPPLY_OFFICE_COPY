{% extends "accounts/User/nav.html" %}


{% load static %}


{% block cart %}

<style>
  .cart_table tbody tr td {
    vertical-align: middle;
  }
</style>


<form action="{% url 'requester' %}" method="post">
    {% csrf_token %} 

    
    <div>
      <div class=" cart table-responsive" style="height: 68vh; overflow-y: auto; overflow-x: hidden; justify-content: center; margin-left: 40%; width: 100%; margin-top: 5%;" >
        <table class="cart_table" id="create_request_table" style="background-color: none; ">
          <thead style="background-color: rgba(0, 50, 102, 0.8);    font-size: 1.2rem; font-family: sans-serif; color: rgb(246, 239, 239); text-align: center; height: 3rem; border: 0.5px solid #060000">
            <tr>
                <th class="text-center text-nowrap" style="min-width: 15rem;">Item Name</th>
                <th class="text-center text-nowrap" style="min-width: 7rem;">Item Brand/Description</th>
                <th class="text-center text-nowrap" style="min-width: 7rem;">Unit</th>
                <th class="text-center text-nowrap" style="min-width: 7rem;">Unit Cost</th>
                <th class="text-center text-nowrap" style="min-width: 7rem;">Quantity</th>
                <th class="text-center text-nowrap" style="min-width: 7rem;">Total Cost</th>
                <th class="text-center text-nowrap" style="min-width: 7rem;"></th>
                <th class="text-center text-nowrap"></th>
                
            </tr>
        </thead>
        
            <tbody>
              {% for item in items %}
              <tr style=  "background-color: rgba(30, 150, 255, 0.3) !important;  border-bottom: 0.2px solid rgba(0, 0, 0, 0.2); ">
                  <td class="item_name text-center">  {{ item.item }} </td>
                  <td class="item_description text-center">{{ item.item_brand_description }}</td>
                  <td class="item_unit text-center">{{ item.unit }}</td>
                  <td class="item_unit_cost text-center">{{ item.unit_cost }}</td>
                  <td class="item_quantity text-center">{{ item.quantity }}</td>
                  <td class="item_total_cost text-center">{{item.total_cost}}</td> <td class="text-center">
                  <td class="text-center">
                    <button class="edit-button" data-item-id="{{ item.id }}" onclick="editRow(this)" style="background-color: transparent; border: none; size: 50%; border-radius: 50%; color: rgb(1, 154, 72);">
                      <i class="fa fa-edit"></i>
                    </button>
                    
                    <script>
                      // Your JavaScript function
                      function editRow(button) {
                        // Retrieve the data-item-id attribute value
                        var itemId = button.getAttribute('data-item-id');
                    
                        // Now you can use itemId as needed, for example, log it to the console
                        console.log('Clicked edit for item with ID:', itemId);
                    
                        // Add your additional logic here, such as opening a modal for editing
                        // or redirecting to an edit page with the item ID in the URL
                      }
                    </script>
                    </button> 
                                
                    <!-- Your HTML button -->
                    <button class="delete-button" data-item-id="{{ item.id }}" onclick="deleteRow(this)" style="background-color: transparent; border: none; size: 50%; border-radius: 50%; color: rgb(157, 2, 2);">
                      <i class="fa fa-trash"></i>
                    </button>
                    
                    <script>
                      // Your JavaScript function
                      function deleteRow(button) {
                        // Retrieve the data-item-id attribute value
                        var itemId = button.getAttribute('data-item-id');
                    
                        // Ask for confirmation before deleting
                        if (confirm('Are you sure you want to delete this record?')) {
                          // Make an AJAX request to delete the record
                          var xhr = new XMLHttpRequest();
                          xhr.open('DELETE', '/your-server-endpoint/' + itemId + '/', true);
                          xhr.setRequestHeader('Content-Type', 'application/json');
                    
                          xhr.onload = function () {
                            if (xhr.status >= 200 && xhr.status < 300) {
                              // Request was successful, handle the response here
                              var response = JSON.parse(xhr.responseText);
                              // You may want to update the UI or take additional actions
                              console.log('Record deleted successfully');
                            } else {
                              // Request failed, handle errors here
                              console.error('Error deleting record:', xhr.statusText);
                            }
                          };
                    
                          xhr.send();
                        }
                      }
                    </script>

                    
                </td>
              </tr>
              {% endfor %}
          </tbody>
        </table>


    

        <div class="row-at-bottom d-flex justify-content-between">
          <div class="purpose">
            <textarea class="purpose_box" id="exampleFormcontrolTextarea1" name="item_purpose" placeholder="Purpose"></textarea>
          </div>
          <div class="total_amount">
            <span>Total Amount: {{total_cost}}</span>
          </div>
          <div class="submit">
            <input type="submit" value="Submit" name="my-submit-button" id="my-submit-button-id">
        </div>
    </form>
    
    <!-- Success message container -->
    <div id="successMessage" style="display: none; color: green; margin-top: 10px;">
        Form submitted successfully!
    </div>
    
    <!-- JavaScript to handle form submission and show success message -->
    <script>
        document.getElementById('myForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the default form submission
    
            // Make an AJAX request to submit the form
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/your-submit-endpoint/', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
    
            // Additional headers or data can be added if needed
    
            xhr.onload = function() {
                if (xhr.status >= 200 && xhr.status < 300) {
                    // Request was successful, show the success message
                    document.getElementById('successMessage').style.display = 'block';
                } else {
                    // Request failed, handle errors here
                    console.error('Error submitting form:', xhr.statusText);
                }
            };
    
            xhr.onerror = function() {
                // Handle network errors here
                console.error('Network error while attempting to submit form');
            };
    
            // Serialize the form data and send the request
            var formData = new FormData(document.getElementById('myForm'));
            xhr.send(formData);
        });
    </script>
      
      </div>
      </div>
  
  </form>



  {% endblock %}